function __init_shaders(){var e=svjs.opengl.ShaderLibrary.Instance();e.Insert("basic",new svjs.opengl.ShaderSource("attribute vec2 vertexPosition;varying vec2 texCoord;void main(void) {texCoord = vertexPosition/2.0 + 0.5;gl_Position = vec4(vertexPosition, 0.0, 1.0);}",svjs.opengl.ShaderType.Vertex)),e.Insert("anaglyph",new svjs.opengl.ShaderSource("precision mediump float;uniform sampler2D leftView;uniform sampler2D rightView;varying vec2 texCoord;void main(void) {vec4 left  = texture2D(leftView, texCoord);vec4 right = texture2D(rightView, texCoord);float grey = 0.2989*left.r + 0.587*left.g + 0.114*left.b;gl_FragColor = vec4(grey, right.g, right.b, 1.0);}",svjs.opengl.ShaderType.Fragment)),e.Insert("sidebyside",new svjs.opengl.ShaderSource("precision mediump float;uniform sampler2D leftView;uniform sampler2D rightView;varying vec2 texCoord;void main(void) {vec2 leftCoord = texCoord*vec2(2.0, 1.0);vec2 rightCoord = texCoord*vec2(2.0, 1.0) - vec2(1.0, 0.0);vec4 left  = texture2D(leftView, leftCoord);vec4 right = texture2D(rightView, rightCoord);gl_FragColor = (texCoord.x < 0.5) ? left : right;}",svjs.opengl.ShaderType.Fragment)),e.Insert("dbir",new svjs.opengl.ShaderSource("precision mediump float;uniform float scale;uniform float bias;uniform sampler2D leftView;uniform sampler2D depthMap;varying vec2 texCoord;void main(void) {vec4 depth = texture2D(depthMap, texCoord);vec2 offset = vec2(scale*depth.r + bias, 0);gl_FragColor = texture2D(leftView, texCoord + offset);}",svjs.opengl.ShaderType.Fragment)),e.Insert("basic",new svjs.opengl.ShaderSource("precision mediump float;uniform sampler2D texture;varying vec2 texCoord;void main(void) {gl_FragColor = texture2D(texture, texCoord);}",svjs.opengl.ShaderType.Fragment))}var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},svjs;!function(e){function t(e){var t=e.min&&"number"==typeof e.min,n=e.max&&"number"==typeof e.max;return t&&n}function n(e){return void 0!==e.href&&void 0!==e.type}function i(e){var t=e.image&&("string"==typeof e.image||n(e)),i=e.depth&&("string"==typeof e.depth||n(e));return t&&i}e.ValidSVOptionsRange=t,e.ValidSVOptionsVideo=n,e.ValidSVOptionsInput=i}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){var t;!function(e){function t(e){return new n(document.createElement(e))}var n=function(){function e(e,t,n){this.element_=e,t&&(this.element_.id=t),n&&(this.element_.className=n)}return e.prototype.Attach=function(e){this.element_.appendChild(e.Element)},e.prototype.AttachAsFirst=function(e){this.element_.insertBefore(e.Element,this.element_.firstChild)},e.prototype.Replace=function(e){var t=this.element_.parentElement;t&&t.replaceChild(e.element_,this.element_)},e.prototype.RemoveAllChildren=function(){for(;this.element_.firstChild;)this.element_.removeChild(this.element_.firstChild)},e.prototype.AddClass=function(e){this.element_.classList.add(e)},e.prototype.RemoveClass=function(e){this.element_.classList.remove(e)},e.prototype.HasParent=function(){return null!==this.element_.parentElement},Object.defineProperty(e.prototype,"Element",{get:function(){return this.element_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Class",{get:function(){return this.element_.className},set:function(e){this.element_.className=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:function(){return this.element_.id},set:function(e){this.element_.id=e},enumerable:!0,configurable:!0}),e}();e.Item=n,e.Generate=t}(t=e.dom||(e.dom={}))}(t=e.ui||(e.ui={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){var t,n=function(){function t(t,n){this.item_=e.dom.Generate("li"),this.item_.AddClass(t),n&&(this.item_.ID=n)}return t.prototype.AddSeparator=function(e){e?this.item_.AddClass("svjs-panel-item-add-separator"):this.item_.RemoveClass("svjs-panel-item-add-separator")},t.prototype.GetElement=function(){return this.item_},t}();!function(e){e[e.None=0]="None",e[e.LeftArrow=1]="LeftArrow",e[e.RightArrow=2]="RightArrow"}(t||(t={}));var i=function(n){function i(e,i){n.call(this,"svjs-panel-item-button",i),this.decorator_=t.None,this.label_=e,this.UpdateElement_()}return __extends(i,n),i.prototype.ShowLeftArrow=function(e){e?this.decorator_=t.LeftArrow:this.decorator_=t.None,this.UpdateElement_()},i.prototype.ShowRightArrow=function(e){e?this.decorator_=t.RightArrow:this.decorator_=t.None,this.UpdateElement_()},i.prototype.AddCallback=function(e){this.item_.Element.addEventListener("click",e)},i.prototype.UpdateElement_=function(){if(this.item_.RemoveAllChildren(),this.decorator_===t.None)this.item_.Element.textContent=this.label_;else{var n=e.dom.Generate("span");n.Element.textContent=this.label_;var i=e.dom.Generate("span");this.decorator_===t.LeftArrow?(i.Element.textContent="‹",n.Element.style.cssFloat="right",n.Element.style.marginLeft="0.5em",this.item_.Attach(i),this.item_.Attach(n)):this.decorator_===t.RightArrow&&(i.Element.textContent="›",i.Element.style.cssFloat="right",n.Element.style.marginRight="0.5em",this.item_.Attach(n),this.item_.Attach(i))}},i}(n);e.PanelButton=i;var r=function(t){function n(n,i,r){t.call(this,"svjs-panel-item-slider",r);var o=e.dom.Generate("span");o.Element.textContent=n,this.slider_=e.dom.Generate("input"),this.slider_.Element.type="range",this.slider_.Element.min=i.min.toString(),this.slider_.Element.max=i.max.toString(),this.item_.Attach(o),this.item_.Attach(this.slider_)}return __extends(n,t),Object.defineProperty(n.prototype,"Value",{get:function(){return this.slider_.Element.valueAsNumber},set:function(e){this.slider_.Element.valueAsNumber=e},enumerable:!0,configurable:!0}),n.prototype.AddCallback=function(e){var t=this;this.slider_.Element.addEventListener("input",function(){e(t.Value)})},n}(n);e.PanelSlider=r;var o=function(t){function n(n,i){t.call(this,"svjs-panel-item-text",i),this.content_=e.dom.Generate("div"),this.content_.Element.innerHTML=n,this.item_.Attach(this.content_)}return __extends(n,t),n.prototype.AddCallback=function(e){},n}(n);e.PanelText=o;var s=function(){function t(t,n){this.entries_=[],this.subpanels_={},this.parent_=null,this.panel_=e.dom.Generate("div"),this.panel_.Attach(e.dom.Generate("ul")),this.panel_.AddClass("svjs-panel"),this.panel_.ID=t,this.name_=n||t}return t.prototype.AddItem=function(e){return e instanceof t?(e.SetParent(this),this.subpanels_[e.ID]=e,this.AddItem(this.SubpanelButton_(e))):(this.entries_.push(e),this.GetList_().Attach(e.GetElement())),this},t.prototype.Show=function(e){e?(this.panel_.RemoveClass("svjs-panel-hidden"),t.Root_?this.panel_.Replace(t.Root_.GetElement()):t.Root_=this):this.panel_.AddClass("svjs-panel-hidden");for(var n in this.subpanels_)this.subpanels_.hasOwnProperty(n)&&this.subpanels_[n].Show(e)},Object.defineProperty(t.prototype,"ID",{get:function(){return this.panel_.ID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Parent",{get:function(){return this.parent_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Visible",{get:function(){var e=this.FindTopLevelPanel();return!e.panel_.Element.classList.contains("svjs-panel-hidden")},enumerable:!0,configurable:!0}),t.prototype.GetElement=function(){return this.panel_},t.prototype.SetParent=function(e){var t=this;this.parent_=e,this.entries_.length>0&&this.entries_[0].AddSeparator(!0);var n=new i("Back");n.ShowLeftArrow(!0),n.AddCallback(function(){t.panel_.Replace(t.parent_.GetElement())}),this.entries_.unshift(n),this.GetList_().AttachAsFirst(n.GetElement())},t.prototype.FindTopLevelPanel=function(){for(var e=this;e.parent_;)e=e.parent_;return e},t.prototype.GetList_=function(){return new e.dom.Item(this.panel_.Element.firstElementChild)},t.prototype.SubpanelButton_=function(e){var t=this,n=new i(e.Name);return n.ShowRightArrow(!0),n.AddSeparator(this.entries_.length>0),n.AddCallback(function(){t.panel_.Replace(e.GetElement())}),n},t.Root_=null,t}();e.Panel=s}(t=e.ui||(e.ui={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){var t=function(){function t(t,n){this.button_=e.dom.Generate("button"),this.Icon=t,n&&(this.button_.ID=n)}return t.prototype.SetCallback=function(e){this.button_.Element.onclick=e},Object.defineProperty(t.prototype,"Icon",{get:function(){return this.icon_},set:function(e){this.icon_&&this.button_.RemoveClass("svjs-button-"+this.icon_),this.icon_=e,this.button_.AddClass("svjs-button-"+this.icon_)},enumerable:!0,configurable:!0}),t.prototype.SetTransform=function(e){this.button_.Element.style.transform=e},t.prototype.GetElement=function(){return this.button_},t}();e.Button=t;var n=function(){function t(t,n){this.group_=e.dom.Generate("span"),this.group_.AddClass(t),n&&(this.group_.ID=n)}return t.prototype.Add=function(e){return this.group_.Attach(e.GetElement()),this},t.prototype.GetElement=function(){return this.group_},t}();e.ButtonGroup=n;var i=function(){function t(t){this.control_bar_=e.dom.Generate("div"),this.control_bar_.AddClass("svjs-controls"),t&&(this.control_bar_.ID=t)}return t.prototype.AddButton=function(e){this.control_bar_.Attach(e.GetElement())},t.prototype.GetElement=function(){return this.control_bar_},t}();e.ControlBar=i}(t=e.ui||(e.ui={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){function t(){for(var e=0,t=s;e<t.length;e++){var n=t[e];if(document[n])return!0}return!1}function n(e){for(var t=e.Element,n=0,i=a;n<i.length;n++){var r=i[n];if(t[r])return t[r](),!0}return!1}function i(){for(var e=0,t=u;e<t.length;e++){var n=t[e];if(document[n]){document[n]();break}}}function r(e){l.forEach(function(t){document.addEventListener(t,function(){e()})})}function o(){for(var e=0,t=c;e<t.length;e++){var n=t[e];if(document[n])return!0}return!1}var s=["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],a=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],u=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],l=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],c=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"];e.FullscreenAvailable=t,e.RequestFullscreen=n,e.ExitFullscreen=i,e.ListenForFullscreen=r,e.InFullscreenMode=o}(t=e.ui||(e.ui={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(){this.button_fullscreen=new e.ui.Button("icon-fullscreen"),this.button_play=new e.ui.Button("icon-play"),this.button_settings=new e.ui.Button("icon-settings"),this.control_bar=new e.ui.ControlBar,this.control_bar.AddButton(new e.ui.ButtonGroup("svjs-float-left").Add(this.button_play)),this.control_bar.AddButton(new e.ui.ButtonGroup("svjs-float-right").Add(this.button_settings).Add(this.button_fullscreen))}return Object.defineProperty(t.prototype,"RootElement",{get:function(){return this.control_bar.GetElement()},enumerable:!0,configurable:!0}),t}();t.VideoControls=n}(n=t.__internal||(t.__internal={}))}(t=e.app||(e.app={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(t){var n;!function(t){var n=function(){function t(t){var n=this,i=t?"Left View":"Original",r=t?"Right View":"Depth Map";this.view_callback_=null,this.options_=[["image",new e.ui.PanelButton(i)],["depth",new e.ui.PanelButton(r)],["anaglyph",new e.ui.PanelButton("Anaglyph")],["side-by-side",new e.ui.PanelButton("Side-by-Side")]],this.menu=new e.ui.Panel("svjs-options-popup-view","Display Type");for(var o=function(e){s.menu.AddItem(e[1]),e[1].AddCallback(function(){n.view_callback_&&n.view_callback_(e[0])})},s=this,a=0,u=this.options_;a<u.length;a++){var l=u[a];o(l)}}return t.prototype.SetCallback=function(e){this.view_callback_=e},t}(),i=function(){function t(t){var n=this,i=t.bias["default"]?t.bias["default"]:0,r=t.scale["default"]?t.scale["default"]:1;this.current_={scale:r,bias:i},this.options_={scale:new e.ui.PanelSlider("Scale",t.scale),bias:new e.ui.PanelSlider("Bias",t.bias)};var o=new e.ui.PanelButton("Reset");o.AddSeparator(!0),this.menu=new e.ui.Panel("svjs-options-popup-dbir","Depth Adjustment");for(var s in this.options_)this.options_.hasOwnProperty(s)&&(this.menu.AddItem(this.options_[s]),this.options_[s].Value=this.current_[s]);this.menu.AddItem(o);var a=function(e){u.options_.hasOwnProperty(e)&&u.options_[e].AddCallback(function(t){n.current_[e]=t,n.adjust_callback_&&n.adjust_callback_(n.current_.scale,n.current_.bias)})},u=this;for(var s in this.options_)a(s);o.AddCallback(function(){n.current_.scale=r,n.current_.bias=i,n.options_.scale.Value=r,n.options_.bias.Value=i,n.adjust_callback_&&n.adjust_callback_(n.current_.scale,n.current_.bias)})}return t.prototype.SetCallback=function(e){this.adjust_callback_=e},t}(),r='<h1>stereovideo.js</h1>An HTML5 video player for stereoscopic content.<p/>Using Google\'s <a href="https://design.google.com/icons/">Material Design Icons</a>.',o=function(){function t(){this.menu=new e.ui.Panel("svjs-options-popup-about","About"),this.menu.AddItem(new e.ui.PanelText(r))}return t}(),s=function(){function t(t){this.panel=new e.ui.Panel("svjs-options-popup","Options"),this.view_menu=new n(t.stereo),this.dbir_menu=new i(t),this.about_panel=new o,this.panel.AddItem(this.view_menu.menu),t.stereo||this.panel.AddItem(this.dbir_menu.menu),this.panel.AddItem(this.about_panel.menu)}return Object.defineProperty(t.prototype,"RootElement",{get:function(){return this.panel.GetElement()},enumerable:!0,configurable:!0}),t}();t.OptionsPopup=s}(n=t.__internal||(t.__internal={}))}(t=e.app||(e.app={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(t){function n(n){var i=function(i){var r=n[i];if(r)if(e.ValidSVOptionsRange(r))r["default"]||(r["default"]=t.kDefaultOptions[i]["default"]);else{if(r.min&&!r.max||!r.min&&r.max)throw"Cannot specify a minimum range value without a maximum and vice-versa.";r.min=t.kDefaultOptions[i].min,r.max=t.kDefaultOptions[i].max,r["default"]=r["default"]||t.kDefaultOptions[i]["default"]}else n[i]=t.kDefaultOptions[i]};i("scale"),i("bias")}t.kDefaultOptions={scale:{min:1,max:20,"default":1},bias:{min:-20,max:20,"default":0},stereo:!1},t.AppendDefaults=n,function(e){e[e.Loading=0]="Loading",e[e.Paused=1]="Paused",e[e.Playing=2]="Playing",e[e.Finished=3]="Finished"}(t.PlayerState||(t.PlayerState={}));var i=t.PlayerState,r=function(){function n(t,n){this.container_=new e.ui.dom.Item(t),this.container_.AddClass("svjs-container"),this.state_=i.Loading,this.InitElements_(n),this.AssembleUI_()}return Object.defineProperty(n.prototype,"PlayerState",{get:function(){return this.state_},set:function(e){switch(e){case i.Loading:break;case i.Paused:this.controls_.button_play.Icon="icon-play";break;case i.Playing:this.controls_.button_play.Icon="icon-pause";break;case i.Finished:this.controls_.button_play.Icon="icon-replay"}this.state_=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RenderingOptionAdjusted",{set:function(e){this.options_panel_.dbir_menu.SetCallback(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"DisplayOptionSelected",{set:function(e){this.options_panel_.view_menu.SetCallback(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PlayButtonClicked",{set:function(e){var t=this;this.controls_.button_play.SetCallback(function(){"icon-play"===t.controls_.button_play.Icon?t.controls_.button_play.Icon="icon-pause":t.controls_.button_play.Icon="icon-play",e()})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"DisplayCanvas",{get:function(){return this.canvas_.Element},enumerable:!0,configurable:!0}),n.prototype.InitElements_=function(n){this.canvas_=e.ui.dom.Generate("canvas"),this.controls_=new t.__internal.VideoControls,this.options_panel_=new t.__internal.OptionsPopup(n),this.canvas_.ID="svjs-canvas",this.options_panel_.panel.Show(!1)},n.prototype.AssembleUI_=function(){var t=this;this.container_.Attach(this.canvas_),this.container_.Attach(this.controls_.RootElement),this.container_.Attach(this.options_panel_.RootElement),this.controls_.button_settings.SetCallback(function(){var e=t.options_panel_.panel.Visible;t.options_panel_.panel.Show(!e),e?t.controls_.button_settings.SetTransform("rotate(0deg)"):t.controls_.button_settings.SetTransform("rotate(30deg)")}),this.controls_.button_fullscreen.SetCallback(function(){e.ui.InFullscreenMode()?(t.controls_.button_fullscreen.Icon="icon-fullscreen",e.ui.ExitFullscreen()):(t.controls_.button_fullscreen.Icon="icon-fullscreen-exit",e.ui.RequestFullscreen(t.container_))})},n}();t.Player=r}(t=e.app||(e.app={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){function t(e){return void 0!==e.width&&void 0!==e.height}e.IsDimensions=t;var n=function(){function e(e,t){"number"==typeof e?(this.width=e,this.height=t):(this.width=e.width,this.height=e.height)}return e}();e.Size=n}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(t){function n(e){return void 0!==e.href}var i=function(){function t(t){if(this.element_=e.ui.dom.Generate("video"),this.element_.Element.style.display="none","string"==typeof t)this.element_.Element.setAttribute("src",t);else{var i=[];n(t)?i.push(t):i=t;for(var r=0,o=i;r<o.length;r++){var s=o[r],a=e.ui.dom.Generate("source");a.Element.setAttribute("src",s.href),s.type&&a.Element.setAttribute("type",s.type),this.element_.Attach(a)}}}return t.prototype.SetCallback=function(e,t){var n=this;this.element_.Element.oncanplaythrough=e,t&&(this.Tag.onprogress=function(){for(var e=n.Tag.buffered,i=0,r=0;r<e.length;r++)i+=e.end(r)-e.start(r);if(n.Tag.duration>0){var o=i/n.Tag.duration;t(o)}})},Object.defineProperty(t.prototype,"width",{get:function(){return this.element_.Element.videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.element_.Element.videoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Tag",{get:function(){return this.element_.Element},enumerable:!0,configurable:!0}),t}();t.Video=i}(t=e.app||(e.app={}))}(svjs||(svjs={}));var StereoVideo=function(){function e(e,t){var n=this;if(!t)throw"Failed to provide runtime options to StereoVideo.";this.options_=t;var i=document.getElementById(e);if(!(i&&i instanceof HTMLDivElement))throw"StereoVideo requires that its container is a <div> element.";if(svjs.app.AppendDefaults(t),this.player_=new svjs.app.Player(i,t),this.opengl_=new svjs.opengl.GLContext(this.player_.DisplayCanvas),!this.opengl_.valid())throw"StereoVideo failed to create the WebGL context.";var r={image:svjs.app.RenderMode.Original,depth:svjs.app.RenderMode.DepthMap,anaglyph:svjs.app.RenderMode.Anaglyph,"side-by-side":svjs.app.RenderMode.SideBySide};this.player_.DisplayOptionSelected=function(e){console.log("Display Type: "+e),n.renderer_.Mode=r[e],n.Render_()},this.player_.RenderingOptionAdjusted=function(e,t){console.log("DBIR Scale: "+e+", Bias: "+t),n.renderer_.DBIRSetting={scale:e,bias:t},n.Render_()},this.player_.PlayButtonClicked=function(){switch(n.player_.PlayerState){case svjs.app.PlayerState.Paused:n.Play();break;case svjs.app.PlayerState.Playing:n.Pause();break;case svjs.app.PlayerState.Finished:n.Reset()}};var o=0,s=function(){++o,2===o&&n.SetupOpenGL_()};this.video_={image:null,depth:null},this.video_.image=new svjs.app.Video(t.video.image),this.video_.depth=new svjs.app.Video(t.video.depth),this.video_.image.SetCallback(s),this.video_.depth.SetCallback(s),this.video_.image.Tag.addEventListener("play",function(){n.video_.depth.Tag.play()}),this.video_.image.Tag.addEventListener("pause",function(){n.video_.depth.Tag.pause()}),this.video_.image.Tag.addEventListener("seeked",function(){n.video_.depth.Tag.currentTime=n.video_.image.Tag.currentTime}),this.video_.image.Tag.addEventListener("ended",function(){n.player_.PlayerState=svjs.app.PlayerState.Finished,n.video_.depth.Tag.pause()}),this.video_.depth.Tag.onseeked=function(){n.Render_()}}return e.prototype.Play=function(){var e=this;this.player_.PlayerState=svjs.app.PlayerState.Playing,this.video_.image.Tag.play(),this.timer_id_=window.requestAnimationFrame(function(t){e.RenderLoop_(t)})},e.prototype.Pause=function(){this.player_.PlayerState=svjs.app.PlayerState.Paused,this.video_.image.Tag.pause(),window.cancelAnimationFrame(this.timer_id_)},e.prototype.Reset=function(){this.player_.PlayerState=svjs.app.PlayerState.Paused,this.video_.image.Tag.currentTime=0},e.prototype.SetupOpenGL_=function(){var e=this.video_.image.width,t=this.video_.image.height;console.log("Display Surface: "+e+"x"+t),this.player_.PlayerState=svjs.app.PlayerState.Paused,this.player_.DisplayCanvas.width=e,this.player_.DisplayCanvas.height=t,this.opengl_.setViewportSize(e,t),this.renderer_=new svjs.app.Renderer(this.opengl_,{width:e,height:t}),this.renderer_.Mode=svjs.app.RenderMode.Original,this.options_.display&&("image"===this.options_.display?this.renderer_.Mode=svjs.app.RenderMode.Original:"depth"===this.options_.display?this.renderer_.Mode=svjs.app.RenderMode.DepthMap:"anaglyph"===this.options_.display?this.renderer_.Mode=svjs.app.RenderMode.Anaglyph:"side-by-side"===this.options_.display&&(this.renderer_.Mode=svjs.app.RenderMode.SideBySide)),this.renderer_.DBIRSetting={scale:1,bias:0},this.Render_()},e.prototype.Render_=function(){var e=null;e=this.options_.stereo?{left:this.video_.image.Tag,right:this.video_.depth.Tag}:{image:this.video_.image.Tag,depthmap:this.video_.depth.Tag},this.renderer_.Render(e)},e.prototype.RenderLoop_=function(e){var t=this;this.Render_(),this.video_.image.Tag.paused||(this.timer_id_=window.requestAnimationFrame(function(e){t.RenderLoop_(e)}))},e}(),svjs;!function(e){var t;!function(e){var t=function(){function e(e,t,n){this.slot_=0,this.texture_=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture_),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),this.fb_=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.fb_),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}return e.prototype.bindFramebuffer=function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.fb_)},e.prototype.unbindFramebuffer=function(e){e.bindFramebuffer(e.FRAMEBUFFER,null)},e.prototype.useFBOTexture=function(e){e.activeTexture(e.TEXTURE0+this.slot_),e.bindTexture(e.TEXTURE_2D,this.texture_)},Object.defineProperty(e.prototype,"slot",{get:function(){return this.slot_},set:function(e){e>=0&&32>e&&(this.slot_=e)},enumerable:!0,configurable:!0}),e}();e.Framebuffer=t}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){var t=function(){function e(e){this.is_valid_=!1,this.ctx_=null;try{var t=e.getContext("webgl")||e.getContext("experimental-webgl");this.ctx_=t,this.is_valid_=!0,this.ctx_.clearColor(0,0,0,1)}catch(n){}}return e.prototype.clearDisplay=function(){this.ctx_.clear(this.ctx_.COLOR_BUFFER_BIT)},e.prototype.setViewportSize=function(e,t){this.ctx_.viewport(0,0,e,t)},e.prototype.valid=function(){return this.is_valid_},e.prototype.getRenderingContext=function(){return this.ctx_},e}();e.GLContext=t}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){!function(e){e[e.Vertex=WebGLRenderingContext.VERTEX_SHADER]="Vertex",e[e.Fragment=WebGLRenderingContext.FRAGMENT_SHADER]="Fragment"}(e.ShaderType||(e.ShaderType={}));var t=e.ShaderType,n=function(){function e(e,t){this.shader_src_=e,this.shader_type_=t}return e.FromScript=function(n){var i=document.getElementById(n);if(!(i&&i instanceof HTMLScriptElement))return null;var r,o=i;switch(o.type){case"text/x-glsl-vert":r=t.Vertex;break;case"text/x-glsl-frag":r=t.Fragment;break;default:return null}for(var s="",a=o.firstChild;a;)a.nodeType===Node.TEXT_NODE&&(s+=a.textContent),a=a.nextSibling;return new e(s,r)},Object.defineProperty(e.prototype,"Source",{get:function(){return this.shader_src_},set:function(e){this.shader_src_=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Type",{get:function(){return this.shader_type_},enumerable:!0,configurable:!0}),e}();e.ShaderSource=n;var i=function(){function e(){if(e.instance_)throw new Error("use instance() to get an instance of a ShaderLibrary");this.shaders_={},this.shaders_[t.Vertex]={},this.shaders_[t.Fragment]={}}return e.Instance=function(){return e.instance_||(e.instance_=new e),e.instance_},e.prototype.Insert=function(e,t){this.shaders_[t.Type][e]=t},e.prototype.GetShader=function(e,t){return this.shaders_[t][e]},e.instance_=void 0,e}();e.ShaderLibrary=i;var r=function(){function e(e,t){this.shader_=e.createShader(t.Type),e.shaderSource(this.shader_,t.Source),e.compileShader(this.shader_),e.getShaderParameter(this.shader_,e.COMPILE_STATUS)?(this.type_=t.Type,this.success_=!0):(console.error(e.getShaderInfoLog(this.shader_)),this.success_=!1)}return e.prototype.getGLSLShader=function(){return this.shader_},e.prototype.wasCompiled=function(){return this.success_},e}();e.GLSLShader=r,function(e){e[e.boolean_t=0]="boolean_t",e[e.int_t=1]="int_t",e[e.float_t=2]="float_t",e[e.vec2=3]="vec2",e[e.ivec2=4]="ivec2",e[e.bvec2=5]="bvec2",e[e.vec3=6]="vec3",e[e.ivec3=7]="ivec3",e[e.bvec3=8]="bvec3",e[e.vec4=9]="vec4",e[e.ivec4=10]="ivec4",e[e.bvec4=11]="bvec4",e[e.mat2=12]="mat2",e[e.mat3=13]="mat3",e[e.mat4=14]="mat4",e[e.sampler2D=15]="sampler2D",e[e.samplerCube=16]="samplerCube"}(e.GLUniformType||(e.GLUniformType={}));var o=e.GLUniformType,s=function(){function e(e,t){switch(this.name=e,t){case WebGLRenderingContext.BOOL:this.type=o.boolean_t;break;case WebGLRenderingContext.INT:this.type=o.int_t;break;case WebGLRenderingContext.FLOAT:this.type=o.float_t;break;case WebGLRenderingContext.FLOAT_VEC2:this.type=o.vec2;break;case WebGLRenderingContext.FLOAT_VEC3:this.type=o.vec3;break;case WebGLRenderingContext.FLOAT_VEC4:this.type=o.vec4;break;case WebGLRenderingContext.INT_VEC2:this.type=o.ivec2;break;case WebGLRenderingContext.INT_VEC3:this.type=o.ivec3;break;case WebGLRenderingContext.INT_VEC4:this.type=o.ivec4;break;case WebGLRenderingContext.BOOL_VEC2:this.type=o.bvec2;break;case WebGLRenderingContext.BOOL_VEC3:this.type=o.bvec3;break;case WebGLRenderingContext.BOOL_VEC4:this.type=o.bvec4;break;case WebGLRenderingContext.FLOAT_MAT2:this.type=o.mat2;break;case WebGLRenderingContext.FLOAT_MAT3:this.type=o.mat3;break;case WebGLRenderingContext.FLOAT_MAT4:this.type=o.mat4;break;case WebGLRenderingContext.SAMPLER_2D:this.type=o.sampler2D;break;case WebGLRenderingContext.SAMPLER_CUBE:this.type=o.samplerCube}}return e}();e.GLObjectInfo=s;var a=function(){function e(e,t,n){this.prog_=e.createProgram(),e.attachShader(this.prog_,t.getGLSLShader()),e.attachShader(this.prog_,n.getGLSLShader()),e.linkProgram(this.prog_),e.getProgramParameter(this.prog_,e.LINK_STATUS)?this.success_=!0:(console.error(e.getProgramInfoLog(this.prog_)),this.success_=!1);var i=0,r=null,o=e.getProgramParameter(this.prog_,e.ACTIVE_UNIFORMS);for(this.uniforms_=new Object,i=0;o>i;i++)r=e.getActiveUniform(this.prog_,i),this.uniforms_[r.name]=new s(r.name,r.type);var a=e.getProgramParameter(this.prog_,e.ACTIVE_ATTRIBUTES);for(this.attributes_=new Object,i=0;a>i;i++)r=e.getActiveAttrib(this.prog_,i),this.attributes_[r.name]=new s(r.name,r.type),e.enableVertexAttribArray(i)}return e.prototype.useProgram=function(e){e.useProgram(this.prog_)},e.prototype.listAttributes=function(){var e=new Array;for(var t in this.attributes_)this.attributes_.hasOwnProperty(t)&&e.push(t);return e},e.prototype.listUniforms=function(){var e=new Array;for(var t in this.uniforms_)this.attributes_.hasOwnProperty(t)&&e.push(t);return e},e.prototype.getAttributeInfo=function(e){return this.attributes_.hasOwnProperty(e)?this.attributes_[e]:null},e.prototype.getAttributeLocation=function(e,t){return this.attributes_.hasOwnProperty(t)?e.getAttribLocation(this.prog_,t):null},e.prototype.getUniformInfo=function(e){return this.uniforms_.hasOwnProperty(e)?this.uniforms_[e]:null},e.prototype.getUniformLocation=function(e,t){return this.uniforms_.hasOwnProperty(t)?e.getUniformLocation(this.prog_,t):null},e.prototype.setUniform=function(e,t,n){if(this.uniforms_.hasOwnProperty(t)){var i=this.uniforms_[t],r=e.getUniformLocation(this.prog_,t);switch(i.type){case o.boolean_t:case o.int_t:e.uniform1i(r,n);break;case o.float_t:e.uniform1f(r,n);break;case o.vec2:e.uniform2fv(r,n);break;case o.vec3:e.uniform3fv(r,n);break;case o.vec4:e.uniform4fv(r,n);break;case o.bvec2:case o.ivec2:e.uniform2iv(r,n);break;case o.bvec3:case o.ivec3:e.uniform3iv(r,n);break;case o.bvec4:case o.ivec4:e.uniform4iv(r,n);break;case o.mat2:e.uniformMatrix2fv(r,!1,n);break;case o.mat3:e.uniformMatrix3fv(r,!1,n);break;case o.mat4:e.uniformMatrix4fv(r,!1,n);break;case o.sampler2D:e.uniform1i(r,n);break;case o.samplerCube:e.uniform1i(r,n)}}},e}();e.GLSLProgram=a}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){var t=function(){function e(e){var t=new Float32Array([1,1,-1,1,1,-1,-1,-1]);this.surface_=e.createBuffer(),this.bind(e),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}return e.prototype.bind=function(e){e.bindBuffer(e.ARRAY_BUFFER,this.surface_)},e.prototype.drawSurface=function(e,t){e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)},e}();e.Surface=t}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(e){function t(e){return e instanceof HTMLImageElement}function n(e){return e instanceof HTMLVideoElement}var i=function(){function i(i,r){this.texture_=i.createTexture(),this.slot_=0;var o=t(r)||n(r);if(t(r))this.width_=r.width,this.height_=r.height;else if(n(r))this.width_=r.videoWidth,this.height_=r.videoHeight;else{if(!e.IsDimensions(r))throw new Error("Data must be either an HTMLImageElement/HTMLVideoElement or something with width/height properties.");this.width_=r.width,this.height_=r.height}i.bindTexture(i.TEXTURE_2D,this.texture_),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),o?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width_,this.height_,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null)}return i.prototype.bindTexture=function(e){e.activeTexture(e.TEXTURE0+this.slot_),e.bindTexture(e.TEXTURE_2D,this.texture_)},i.prototype.updateTexture=function(e,i){if(!n(i)&&!t(i))throw"Data must be either an HTMLImageElement or HTMLVideoElement.";e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,i)},Object.defineProperty(i.prototype,"slot",{get:function(){return this.slot_},set:function(e){e>=0&&32>e&&(this.slot_=e)},enumerable:!0,configurable:!0}),i}();e.Texture=i}(t=e.opengl||(e.opengl={}))}(svjs||(svjs={}));var svjs;!function(e){var t;!function(t){function n(e){return void 0!==e.left&&void 0!==e.right}!function(e){e[e.Original=0]="Original",e[e.DepthMap=1]="DepthMap",e[e.Anaglyph=2]="Anaglyph",e[e.SideBySide=3]="SideBySide"}(t.RenderMode||(t.RenderMode={}));var i,r=t.RenderMode;!function(e){e[e.PassThrough=0]="PassThrough",e[e.DBIR=1]="DBIR",e[e.Anaglyph=2]="Anaglyph",e[e.SideBySide=3]="SideBySide"}(i||(i={}));var o=function(){function t(t,n){this.gl_context_=t,this.surface_size_=n;var r=this.gl_context_.getRenderingContext();this.programs_=[],this.programs_[i.PassThrough]=this.GenerateShader_("basic","basic"),
this.programs_[i.DBIR]=this.GenerateShader_("basic","dbir"),this.programs_[i.Anaglyph]=this.GenerateShader_("basic","anaglyph"),this.programs_[i.SideBySide]=this.GenerateShader_("basic","sidebyside"),this.surface_=new e.opengl.Surface(r),this.framebuffer_=new e.opengl.Framebuffer(r,this.surface_size_.width,this.surface_size_.height),this.framebuffer_.slot=1,this.textures_=[],this.textures_[0]=new e.opengl.Texture(r,this.surface_size_),this.textures_[1]=new e.opengl.Texture(r,this.surface_size_),this.textures_[0].slot=0,this.textures_[1].slot=1}return t.prototype.Render=function(e){var t=this.gl_context_.getRenderingContext();switch(this.PrepareTextures_(e),n(e)||this.RenderSyntheticView_(e),this.render_mode_){case r.Original:this.SetupPassThrough_(0);break;case r.DepthMap:this.SetupPassThrough_(1);break;case r.Anaglyph:this.SetupShader_(i.Anaglyph);break;case r.SideBySide:this.SetupShader_(i.SideBySide)}this.surface_.bind(t),this.surface_.drawSurface(t,this.vertex_attrib)},Object.defineProperty(t.prototype,"DBIRSetting",{get:function(){return this.dbir_opts_},set:function(e){this.dbir_opts_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Mode",{get:function(){return this.render_mode_},set:function(e){this.render_mode_=e},enumerable:!0,configurable:!0}),t.prototype.GenerateShader_=function(t,n){console.log("-- generating shader -> "+t+" + "+n);var i=e.opengl.ShaderLibrary.Instance(),r=this.gl_context_.getRenderingContext(),o=i.GetShader(t,e.opengl.ShaderType.Vertex),s=i.GetShader(n,e.opengl.ShaderType.Fragment),a=new e.opengl.GLSLShader(r,o),u=new e.opengl.GLSLShader(r,s);return new e.opengl.GLSLProgram(r,a,u)},t.prototype.PrepareTextures_=function(e){var t=this.gl_context_.getRenderingContext();n(e)?(this.textures_[0].bindTexture(t),this.textures_[0].updateTexture(t,e.left),this.textures_[1].bindTexture(t),this.textures_[1].updateTexture(t,e.right)):(this.textures_[0].bindTexture(t),this.textures_[0].updateTexture(t,e.image),this.textures_[1].bindTexture(t),this.textures_[1].updateTexture(t,e.depthmap))},t.prototype.SetupPassThrough_=function(e){var t=this.gl_context_.getRenderingContext(),n=this.programs_[i.PassThrough];n.useProgram(t),n.setUniform(t,"texture",e),this.vertex_attrib=n.getAttributeLocation(t,"vertexPosition")},t.prototype.SetupShader_=function(e){var t=this.gl_context_.getRenderingContext(),n=this.programs_[e];n.useProgram(t),n.setUniform(t,"leftView",0),n.setUniform(t,"rightView",1),this.vertex_attrib=n.getAttributeLocation(t,"vertexPosition")},t.prototype.NeedRenderSynthetic_=function(){return this.render_mode_!==r.Original&&this.render_mode_!==r.DepthMap},t.prototype.RenderSyntheticView_=function(e){if(this.NeedRenderSynthetic_()){var t=this.gl_context_.getRenderingContext(),n=Math.max(e.image.videoWidth,e.image.videoHeight),r=this.dbir_opts_.scale/n,o=this.dbir_opts_.bias/n;this.framebuffer_.bindFramebuffer(t);var s=this.programs_[i.DBIR];s.useProgram(t),s.setUniform(t,"leftView",0),s.setUniform(t,"depthMap",1),s.setUniform(t,"scale",r),s.setUniform(t,"bias",o);var a=s.getAttributeLocation(t,"vertexPosition");this.surface_.bind(t),this.surface_.drawSurface(t,a),this.framebuffer_.unbindFramebuffer(t),this.framebuffer_.useFBOTexture(t)}},t}();t.Renderer=o}(t=e.app||(e.app={}))}(svjs||(svjs={})),__init_shaders();